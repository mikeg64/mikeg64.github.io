\hypertarget{shkset3d_8c}{}\doxysection{src/prob/shkset3d.c File Reference}
\label{shkset3d_8c}\index{src/prob/shkset3d.c@{src/prob/shkset3d.c}}


Sets up shock at angle to grid to test 3D algorithms.  


{\ttfamily \#include \char`\"{}copyright.\+h\char`\"{}}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include \char`\"{}defs.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}athena.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}globals.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}prototypes.\+h\char`\"{}}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{shkset3d_8c_a1b323f47153f1975b64382e0ffac6b73}{problem}} (\mbox{\hyperlink{struct_domain_s}{DomainS}} $\ast$p\+Domain)
\item 
void \mbox{\hyperlink{shkset3d_8c_a2c334369ab621e9815591c76ccfb5fc7}{problem\+\_\+write\+\_\+restart}} (\mbox{\hyperlink{struct_mesh_s}{MeshS}} $\ast$pM, F\+I\+LE $\ast$fp)
\item 
void \mbox{\hyperlink{shkset3d_8c_acf733c9792756cbec1e9d226c4ff37ab}{problem\+\_\+read\+\_\+restart}} (\mbox{\hyperlink{struct_mesh_s}{MeshS}} $\ast$pM, F\+I\+LE $\ast$fp)
\item 
\mbox{\hyperlink{athena_8h_aaa64b3ee5eefc566b7c09368c414de89}{Cons\+Fun\+\_\+t}} \mbox{\hyperlink{shkset3d_8c_a4575c4cdbf2965a9857c45970d736676}{get\+\_\+usr\+\_\+expr}} (const char $\ast$expr)
\item 
\mbox{\hyperlink{athena_8h_a8bc2403d4d3a27d6f475f2dc6acc94cc}{V\+Out\+Fun\+\_\+t}} \mbox{\hyperlink{shkset3d_8c_a8b8cabb1061d5399fb492be89de213ff}{get\+\_\+usr\+\_\+out\+\_\+fun}} (const char $\ast$\mbox{\hyperlink{streaming3d__single_8c_ae5cb967283dbbdf75cb2032c1fa08fee}{name}})
\item 
void \mbox{\hyperlink{shkset3d_8c_a0ff640c24db1dc0d7c89d91f1d55ffce}{Userwork\+\_\+in\+\_\+loop}} (\mbox{\hyperlink{struct_mesh_s}{MeshS}} $\ast$pM)
\item 
void \mbox{\hyperlink{shkset3d_8c_a5506a1df41ed88e038443271b9785337}{Userwork\+\_\+after\+\_\+loop}} (\mbox{\hyperlink{struct_mesh_s}{MeshS}} $\ast$pM)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Sets up shock at angle to grid to test 3D algorithms. 

P\+U\+R\+P\+O\+SE\+: Sets up shock at angle to grid to test 3D algorithms. Setting up the initial conditions to minimize grid noise is very complex, so this special function has been written to handle only 3D problems.

This problem cannot be run with Static Mesh Refinement.

This code is most easily understood in terms of a one dimensional problem in the coordinate system (x1,x2,x3). Two coordinate rotations are applied to obtain a new wave vector in a 3D space in the (x,y,z) coordinate system.

First rotate about the x2 axis\+:
\begin{DoxyItemize}
\item x1\textquotesingle{} = x1$\ast$cos(ang\+\_\+2) -\/ x3$\ast$sin(ang\+\_\+2)
\item x2\textquotesingle{} = x2
\item x3\textquotesingle{} = x1$\ast$sin(ang\+\_\+2) + x3$\ast$cos(ang\+\_\+2)

Next rotate about the x3\textquotesingle{} axis\+:
\begin{DoxyItemize}
\item x = x1\textquotesingle{}$\ast$cos(ang\+\_\+3) -\/ x2\textquotesingle{}$\ast$sin(ang\+\_\+3)
\item y = x1\textquotesingle{}$\ast$sin(ang\+\_\+3) + x2\textquotesingle{}$\ast$cos(ang\+\_\+3)
\item z = x3\textquotesingle{}
\end{DoxyItemize}

Expanding this out we get\+:
\begin{DoxyItemize}
\item x = x1$\ast$cos(ang\+\_\+2)$\ast$cos(ang\+\_\+3) -\/ x2$\ast$sin(ang\+\_\+3) -\/ x3$\ast$sin(ang\+\_\+2)$\ast$cos(ang\+\_\+3)
\item y = x1$\ast$cos(ang\+\_\+2)$\ast$sin(ang\+\_\+3) + x2$\ast$cos(ang\+\_\+3) -\/ x3$\ast$sin(ang\+\_\+2)$\ast$sin(ang\+\_\+3)
\item z = x1$\ast$sin(ang\+\_\+2) + x3$\ast$cos(ang\+\_\+2)
\end{DoxyItemize}

This inverts to\+:
\begin{DoxyItemize}
\item x1 = x$\ast$cos(ang\+\_\+2)$\ast$cos(ang\+\_\+3) + y$\ast$cos(ang\+\_\+2)$\ast$sin(ang\+\_\+3) + z$\ast$sin(ang\+\_\+2)
\item x2 = -\/x$\ast$sin(ang\+\_\+3) + y$\ast$cos(ang\+\_\+3)
\item x3 = -\/x$\ast$sin(ang\+\_\+2)$\ast$cos(ang\+\_\+3) -\/ y$\ast$sin(ang\+\_\+2)$\ast$sin(ang\+\_\+3) + z$\ast$cos(ang\+\_\+2) Note these transformations are the same used in linear\+\_\+wave3d and cpaw3d
\end{DoxyItemize}
\end{DoxyItemize}

The initial conditions must be translation invariant, i.\+e. q(x,y,z) = q(x+tx, y+ty, z+tz) for (tx,ty,tz) such that x1(x,y,z) = x1(x+tx, y+ty, z+ty). Inserting this last expression for x1(x,y,z) into the transformation above leads to


\begin{DoxyItemize}
\item tx$\ast$cos(ang\+\_\+2)$\ast$cos(ang\+\_\+3) + ty$\ast$cos(ang\+\_\+2)$\ast$sin(ang\+\_\+3) + tz$\ast$sin(ang\+\_\+2) = 0.
\end{DoxyItemize}

Now, restrict the translation symmetry to be discrete by inserting (tx, ty, tz) = (nx$\ast$dx, ny$\ast$dy, nz$\ast$dz) where (nx, ny, nz) are integers (not the number of grid cells in each direction) and (dx, dy, dz) are the grid cell sizes. With some simplification the translation symmetry becomes


\begin{DoxyItemize}
\item nx + ny$\ast$tan(ang\+\_\+3)$\ast$(dy/dx) + nz$\ast$(tan(ang\+\_\+2)/cos(ang\+\_\+3))$\ast$(dz/dx) = 0.
\end{DoxyItemize}

Now, choose an integer unit cell size (rx, ry, rz) where


\begin{DoxyItemize}
\item tan(ang\+\_\+3)$\ast$(dy/dx) = (rx/ry)
\end{DoxyItemize}

and


\begin{DoxyItemize}
\item (tan(ang\+\_\+2)/cos(ang\+\_\+3))$\ast$(dz/dx) = (rx/rz).
\end{DoxyItemize}

With this choice, or equation for discrete translation symmetry becomes
\begin{DoxyItemize}
\item (nx/rx) + (ny/ry) + (nz/rz) = 0.
\end{DoxyItemize}

If error\+\_\+test=1 in the $<$problem$>$ block, then the L1 error in the final solution will be computed for the Sod shocktube (hydrodynamics) or the R\+J2a test (M\+HD). This is useful for regression tests.

P\+R\+I\+V\+A\+TE F\+U\+N\+C\+T\+I\+ON P\+R\+O\+T\+O\+T\+Y\+P\+ES\+:
\begin{DoxyItemize}
\item lx\+\_\+bc() -\/ use periodicity of \char`\"{}unit cell\char`\"{} to apply B\+Cs to left-\/x edge
\item rx\+\_\+bc() -\/ use periodicity of \char`\"{}unit cell\char`\"{} to apply B\+Cs to right-\/x edge
\item ly\+\_\+bc() -\/ use periodicity of \char`\"{}unit cell\char`\"{} to apply B\+Cs to left-\/y edge
\item ry\+\_\+bc() -\/ use periodicity of \char`\"{}unit cell\char`\"{} to apply B\+Cs to right-\/y edge
\item lz\+\_\+bc() -\/ use periodicity of \char`\"{}unit cell\char`\"{} to apply B\+Cs to left-\/z edge
\item rz\+\_\+bc() -\/ use periodicity of \char`\"{}unit cell\char`\"{} to apply B\+Cs to right-\/z edge
\item Ax() -\/ x-\/component of vector potential for initial conditions
\item Ay() -\/ y-\/component of vector potential for initial conditions
\item Az() -\/ z-\/component of vector potential for initial conditions
\end{DoxyItemize}

This is the equation for a set of discrete points which lie in a plane and is a key relation for setting ghost cells in the boundary condition routines below. -- T. A. Gardiner -- 7/21/2006 ~\newline
 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{shkset3d_8c_a4575c4cdbf2965a9857c45970d736676}\label{shkset3d_8c_a4575c4cdbf2965a9857c45970d736676}} 
\index{shkset3d.c@{shkset3d.c}!get\_usr\_expr@{get\_usr\_expr}}
\index{get\_usr\_expr@{get\_usr\_expr}!shkset3d.c@{shkset3d.c}}
\doxysubsubsection{\texorpdfstring{get\_usr\_expr()}{get\_usr\_expr()}}
{\footnotesize\ttfamily \mbox{\hyperlink{athena_8h_aaa64b3ee5eefc566b7c09368c414de89}{Cons\+Fun\+\_\+t}} get\+\_\+usr\+\_\+expr (\begin{DoxyParamCaption}\item[{const char $\ast$}]{expr }\end{DoxyParamCaption})}



Definition at line 935 of file shkset3d.\+c.

\mbox{\Hypertarget{shkset3d_8c_a8b8cabb1061d5399fb492be89de213ff}\label{shkset3d_8c_a8b8cabb1061d5399fb492be89de213ff}} 
\index{shkset3d.c@{shkset3d.c}!get\_usr\_out\_fun@{get\_usr\_out\_fun}}
\index{get\_usr\_out\_fun@{get\_usr\_out\_fun}!shkset3d.c@{shkset3d.c}}
\doxysubsubsection{\texorpdfstring{get\_usr\_out\_fun()}{get\_usr\_out\_fun()}}
{\footnotesize\ttfamily \mbox{\hyperlink{athena_8h_a8bc2403d4d3a27d6f475f2dc6acc94cc}{V\+Out\+Fun\+\_\+t}} get\+\_\+usr\+\_\+out\+\_\+fun (\begin{DoxyParamCaption}\item[{const char $\ast$}]{name }\end{DoxyParamCaption})}



Definition at line 940 of file shkset3d.\+c.

\mbox{\Hypertarget{shkset3d_8c_a1b323f47153f1975b64382e0ffac6b73}\label{shkset3d_8c_a1b323f47153f1975b64382e0ffac6b73}} 
\index{shkset3d.c@{shkset3d.c}!problem@{problem}}
\index{problem@{problem}!shkset3d.c@{shkset3d.c}}
\doxysubsubsection{\texorpdfstring{problem()}{problem()}}
{\footnotesize\ttfamily void problem (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_domain_s}{DomainS}} $\ast$}]{p\+Domain }\end{DoxyParamCaption})}



Definition at line 142 of file shkset3d.\+c.

\mbox{\Hypertarget{shkset3d_8c_acf733c9792756cbec1e9d226c4ff37ab}\label{shkset3d_8c_acf733c9792756cbec1e9d226c4ff37ab}} 
\index{shkset3d.c@{shkset3d.c}!problem\_read\_restart@{problem\_read\_restart}}
\index{problem\_read\_restart@{problem\_read\_restart}!shkset3d.c@{shkset3d.c}}
\doxysubsubsection{\texorpdfstring{problem\_read\_restart()}{problem\_read\_restart()}}
{\footnotesize\ttfamily void problem\+\_\+read\+\_\+restart (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_mesh_s}{MeshS}} $\ast$}]{pM,  }\item[{F\+I\+LE $\ast$}]{fp }\end{DoxyParamCaption})}



Definition at line 930 of file shkset3d.\+c.

\mbox{\Hypertarget{shkset3d_8c_a2c334369ab621e9815591c76ccfb5fc7}\label{shkset3d_8c_a2c334369ab621e9815591c76ccfb5fc7}} 
\index{shkset3d.c@{shkset3d.c}!problem\_write\_restart@{problem\_write\_restart}}
\index{problem\_write\_restart@{problem\_write\_restart}!shkset3d.c@{shkset3d.c}}
\doxysubsubsection{\texorpdfstring{problem\_write\_restart()}{problem\_write\_restart()}}
{\footnotesize\ttfamily void problem\+\_\+write\+\_\+restart (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_mesh_s}{MeshS}} $\ast$}]{pM,  }\item[{F\+I\+LE $\ast$}]{fp }\end{DoxyParamCaption})}



Definition at line 925 of file shkset3d.\+c.

\mbox{\Hypertarget{shkset3d_8c_a5506a1df41ed88e038443271b9785337}\label{shkset3d_8c_a5506a1df41ed88e038443271b9785337}} 
\index{shkset3d.c@{shkset3d.c}!Userwork\_after\_loop@{Userwork\_after\_loop}}
\index{Userwork\_after\_loop@{Userwork\_after\_loop}!shkset3d.c@{shkset3d.c}}
\doxysubsubsection{\texorpdfstring{Userwork\_after\_loop()}{Userwork\_after\_loop()}}
{\footnotesize\ttfamily void Userwork\+\_\+after\+\_\+loop (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_mesh_s}{MeshS}} $\ast$}]{pM }\end{DoxyParamCaption})}



Definition at line 949 of file shkset3d.\+c.

\mbox{\Hypertarget{shkset3d_8c_a0ff640c24db1dc0d7c89d91f1d55ffce}\label{shkset3d_8c_a0ff640c24db1dc0d7c89d91f1d55ffce}} 
\index{shkset3d.c@{shkset3d.c}!Userwork\_in\_loop@{Userwork\_in\_loop}}
\index{Userwork\_in\_loop@{Userwork\_in\_loop}!shkset3d.c@{shkset3d.c}}
\doxysubsubsection{\texorpdfstring{Userwork\_in\_loop()}{Userwork\_in\_loop()}}
{\footnotesize\ttfamily void Userwork\+\_\+in\+\_\+loop (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_mesh_s}{MeshS}} $\ast$}]{pM }\end{DoxyParamCaption})}



Definition at line 944 of file shkset3d.\+c.

